<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Payment Statement</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body>
  <div class="container mt-5">
    <h3>Payment Statement</h3>
    <form id="paymentForm" class="row g-3">
      <div class="col-md-4">
        <label for="startDate" class="form-label">Start Date</label>
        <input type="date" class="form-control" id="startDate" name="startDate" required>
      </div>
      <div class="col-md-4">
        <label for="endDate" class="form-label">End Date</label>
        <input type="date" class="form-control" id="endDate" name="endDate" required>
      </div>
      <div class="col-md-4 align-self-end">
        <button type="submit" class="btn btn-primary">Get Statement</button>
      </div>
    </form>

    <div id="result" class="mt-5">
      <!-- Payment statement will appear here -->
    </div>
  </div>

  <script>
    $(document).ready(function() {
      $('#paymentForm').submit(function(e) {
        e.preventDefault();

        const startDate = $('#startDate').val();
        const endDate = $('#endDate').val();

        if (!startDate || !endDate) {
          alert('Please select both start and end dates.');
          return;
        }

        $.ajax({
          url: 'http://localhost:3001/admin/portal/payments/payment', // Your NestJS endpoint
          type: 'POST',
          contentType: 'application/json',
          data: JSON.stringify({
            startDate,
            endDate,
            page: 1,
            limit: 20
          }),
          success: function(response) {
            console.log(response);

            // Display results in table
            let html = `
              <h5>Page ${response.currentPage} / ${response.totalPages}</h5>
              <table class="table table-bordered mt-3">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Payment Date</th>
                    <th>Amount</th>
                    <th>Description</th>
                  </tr>
                </thead>
                <tbody>
            `;

            response.payments.forEach((p, index) => {
              html += `
                <tr>
                  <td>${index + 1}</td>
                  <td>${new Date(p.paymentDate).toLocaleDateString()}</td>
                  <td>${p.amount}</td>
                  <td>${p.description || '-'}</td>
                </tr>
              `;
            });

            html += `
                </tbody>
              </table>
              <p><strong>Page Total:</strong> ${response.pageTotal}</p>
              <p><strong>Grand Total:</strong> ${response.grandTotal}</p>
            `;

            $('#result').html(html);
          },
          error: function(err) {
            console.error(err);
            alert('Error fetching payment statement.');
          }
        });
      });
    });
  </script>
</body>

</html>